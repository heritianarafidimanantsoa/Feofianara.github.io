<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, user-scalable=no"
        />
        <title>Feon'i Fianarantsoa</title>
        <link rel="icon" href="./img/feo.png" />
        <link rel="stylesheet" href="/assets/css/style.css" />
        <link rel="stylesheet" href="/assets/css/description.css" />
        <link rel="stylesheet" href="/assets/css/descriptionStyle.css" />
        <script src="./gsap/gsap.min.js"></script>
    </head>
    <body>
        <!-- Structure de la modale -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>

                <!-- Insérez ici vos listes de lieux -->
                <div class="list-container">
                    <h2>Liste des lieux</h2>
                    <!-- Correction du titre (singulier) -->
                    <ul id="jsonList"></ul>
                </div>
            </div>
        </div>

        <!-- Tous les lieux -->
        <div>
            <button id="submit-btn" class="button_lieux">
                <span class="icon_container">
                    <img
                        src="./img/recherche-de-carte-blanc.png"
                        class="icon_white"
                        alt="Icon blanc"
                    />
                </span>
                <span class="icon_container">
                    <img
                        src="./img/recherche-de-carte-noir.png"
                        class="icon_black"
                        alt="Icon noir"
                    />
                </span>
                Tous les lieux
            </button>
        </div>

        <div class="navbar" id="navbar">
            <div class="navbar-logo">
                <img class="logofeo" src="./img/feo.png" href="index.html" />
            </div>
            <div class="navbar-icons">
                <img id="soundIcon" src="./img/music.png" alt="Musique" />
                <img src="./img/map.png" alt="Maps" id="buttonMap" />
            </div>
        </div>

        <!-- chargement du site barre de progression -->
        <section class="progress-bar-container">
            <label for="progress-bar">Loading</label>
            <progress id="progress-bar" value="0" max="100"></progress>
        </section>

        <!-- première présentation du site -->
        <section class="header">
            <h1>Feon'i Fianarantsoa</h1>
            <button class="btn btn1" id="explorer_bt">Explorer</button>
        </section>

        <!-- div stocke le nom du lieur lorqu'on survole lanterne -->
        <div id="titre_lieu"></div>
        <div id="list"></div>

        <!-- fon separateur du presentation du lieu et la carte -->
        <div id="cont" class="dark-mode"></div>
        <div id="container" class="dark-mode"></div>
        <div class="backgroundExplorer" id="backgroundExplorer"></div>

        <!-- Plus d'infos sur ce lieu dans le scéne 360-->
        <button id="show_description" class="show_description">
            <div class="show_icon">
                <img
                    src="./img/info_blanc.png"
                    class="show_icon_white"
                    alt="Icon blanche"
                />
            </div>
            <div class="show_icon">
                <img
                    src="./img/info_noir.png"
                    class="show_icon_black"
                    alt="Icon noire"
                />
            </div>
            <div class="info_titre">Plus d'infos sur ce lieu</div>
        </button>

        <!-- contenue du Plus d'infos sur ce lieu -->
        <div id="desc-main" class="desc-main">
            <!----------------------------MENU------------------------>
            <div class="menu">
                <div id="nom-lieu" class="menu_gauche">Marché du Zoma</div>
                <div class="menu_droite">
                    <div id="rideau">
                        <span class="nav-toggler">Changer de lieu</span>
                    </div>
                    <div id="sound">
                        <img class="sound" src="img/sound.png" alt="Son" />
                    </div>

                    <div id="quiter_description">
                        <img class="croix" src="img/croix.png" alt="Fermer" />
                    </div>
                </div>
            </div>

            <!----------------------------RIDEAU------------------------>
            <nav id="conteneur_menu">
                <div class="block">
                    <div class="element">
                        <img src="img/galery/anosy 1.JPG" alt="Anosy" />
                        <p>Anosy</p>
                    </div>
                    <div class="element">
                        <img
                            src="img/galery/cathedrale 5.JPG"
                            alt="Cathédrale"
                        />
                        <p>Cathédrale</p>
                    </div>
                    <div class="element">
                        <img
                            src="img/galery/Gare FCE 2.JPG"
                            alt="Circulation"
                        />
                        <p>Circulation</p>
                    </div>
                    <div class="element">
                        <img
                            src="img/galery/universiter.jpg"
                            alt="Enseignement"
                        />
                        <p>Enseignement</p>
                    </div>
                    <div class="element">
                        <img
                            src="img/galery/Escalier des téléphones 1.JPG"
                            alt="Escalier des téléphones"
                        />
                        <p>Escalier des téléphones</p>
                    </div>
                    <div class="element">
                        <img
                            src="img/galery/Escalier mort-homme 2.JPG"
                            alt="Escalier mort-homme"
                        />
                        <p>Escalier mort-homme</p>
                    </div>
                    <div class="element">
                        <img src="img/galery/Gare FCE 1.JPG" alt="Gare FCE" />
                        <p>Gare FCE</p>
                    </div>
                    <div class="element">
                        <img
                            src="img/galery/Lapan_ny Tanana 1.JPG"
                            alt="Lapan'ny Tanana"
                        />
                        <p>Lapan'ny Tanana</p>
                    </div>
                    <div class="element">
                        <img
                            src="img/galery/Marache ajoma 6.JPG"
                            alt="Marché du Zoma"
                        />
                        <p>Marché du Zoma</p>
                    </div>
                    <div class="element">
                        <img
                            src="img/galery/Monuments centre ville 2.JPG"
                            alt="Monuments de la ville"
                        />
                        <p>Monuments de la ville</p>
                    </div>
                    <div class="element">
                        <img
                            src="img/galery/Point de Vue + paysage de rizière 7.jpg"
                            alt="Point de vue et rizières"
                        />
                        <p>Point de vue et rizières</p>
                    </div>
                    <div class="element">
                        <img
                            src="img/galery/Porte Vieille Ville 3.JPG"
                            alt="Porte d’entrée de la Vieille Ville"
                        />
                        <p>Porte d’entrée de la Vieille Ville</p>
                    </div>
                    <div class="element">
                        <img src="img/galery/rova 1.JPG" alt="Rova" />
                        <p>Rova</p>
                    </div>
                    <div class="element">
                        <img
                            src="img/galery/Statue de la Vierge 2.JPG"
                            alt="Statue de la Vierge"
                        />
                        <p>Statue de la Vierge</p>
                    </div>
                    <div class="element">
                        <img
                            src="img/galery/Pierrot Men_3_Point de Vue (1).jpg"
                            alt="Point de vue"
                        />
                        <p>Point de vue</p>
                    </div>
                </div>
            </nav>

            <script type="text/javascript">
                const toggler = document.querySelector(".nav-toggler");
                const navigation = document.querySelector("nav");

                toggler.addEventListener("click", toggleNav);

                function toggleNav() {
                    toggler.classList.toggle("active");
                    navigation.classList.toggle("active");

                    // Changer le texte du bouton
                    if (toggler.textContent === "Changer de lieu") {
                        toggler.textContent = "Fermer";
                    } else {
                        toggler.textContent = "Changer de lieu";
                    }
                }
            </script>

            <!----------------------------FILTRE------------------------>

            <div
                id="myScroll"
                style="
                    overflow-y: scroll;
                    width: 100%;
                    height: 100%;
                    position: relative;
                    background-color: #191919;
                "
            >
                <!----------------------------FILTRE------------------------>

                <div class="conteneur_haut">
                    <div id="filtre"></div>
                    <div class="conteneur_nom">
                        <h1 id="nom">Marché du Zoma</h1>
                    </div>
                    <img
                        id="image_principale"
                        class="img img_fixed"
                        src=""
                        alt="Image"
                    />
                    <div class="texte_filtre">
                        <p id="desc1"></p>
                    </div>
                </div>

                <script type="text/javascript">
                    const img = document.querySelector(".img");
                    deScrol = 0; //1300
                    var divScrollable = document.getElementById("myScroll");
                    divScrollable.addEventListener("scroll", function (e) {
                        const apparitionQuestion =
                            document.querySelector(".img");
                        var scrollTop = divScrollable.scrollTop;

                        if (scrollTop > 900 - deScrol) {
                            img.classList.remove("img_fixed");
                            img.classList.add("img_absolute");
                            img.style.opacity = 0;
                        } else {
                            img.classList.add("img_fixed");
                            img.classList.remove("img_absolute");
                            img.style.opacity = 1;
                        }
                    });
                </script>

                <!----------------------------CONTENEUR PAGE------------------------>

                <div class="conteneur_bas">
                    <!----------------------------QUESTION REPONSES------------------------>
                    <div class="center question">
                        <p
                            id="question"
                            class="apparitionQuestion questionInvisible"
                        >
                            Quelle est la plus belle chose de Fianarantsoa selon
                            vous ?
                        </p>
                    </div>

                    <div class="ligne1_bis">
                        <div class="audio1 invisible4" id="playButton1">
                            <img
                                class="play1"
                                src="img/play.png"
                                alt="play music"
                            />
                        </div>
                        <div class="texte1">
                            <h2 id="nom1" class="apparition2 invisible2">
                                Mahera
                            </h2>
                            <p id="comment1" class="apparition3 invisible3">
                                &laquo; C'est un des plus beaux endroits de la
                                ville ! &raquo;
                            </p>
                        </div>
                    </div>

                    <div class="ligne2_bis">
                        <div class="texte2">
                            <h2 id="nom2" class="apparition5 invisible5">
                                Tokiarivelo
                            </h2>
                            <p id="comment2" class="apparition7 invisible7">
                                &laquo; J'aime cet endroit car il représente
                                bien Fianarantsoa &raquo;
                            </p>
                        </div>
                        <div class="audio2 invisible6" id="playButton2">
                            <img
                                class="play2"
                                src="img/play.png"
                                alt="play music"
                            />
                        </div>
                    </div>

                    <script type="text/javascript">
                        divScrollable = document.getElementById("myScroll");

                        /***********************APPARITION QUESTION*************************/
                        divScrollable.addEventListener("scroll", function (e) {
                            const apparitionQuestion = document.querySelector(
                                ".apparitionQuestion"
                            );
                            var scrollTop = divScrollable.scrollTop;

                            if (scrollTop > 1200 - deScrol) {
                                apparitionQuestion.classList.remove(
                                    "questionInvisible"
                                );
                                apparitionQuestion.classList.add(
                                    "questionVisible"
                                );
                            } else {
                                apparitionQuestion.classList.add(
                                    "questionInvisible"
                                );
                                apparitionQuestion.classList.remove(
                                    "questionVisible"
                                );
                            }
                        });

                        /***********************APPARITION PERSONNE 1*************************/
                        const apparition2 =
                            document.querySelector(".apparition2");
                        const apparitionAudio1 =
                            document.querySelector(".audio1");

                        divScrollable.addEventListener("scroll", function (e) {
                            var scrollTop = divScrollable.scrollTop;

                            if (scrollTop > 1300 - deScrol) {
                                apparition2.classList.remove("invisible2");
                                apparition2.classList.add("visible2");
                                apparitionAudio1.classList.remove("invisible4");
                                apparitionAudio1.classList.add("visible4");
                            } else {
                                apparition2.classList.add("invisible2");
                                apparition2.classList.remove("visible2");
                                apparitionAudio1.classList.add("invisible4");
                                apparitionAudio1.classList.remove("visible4");
                            }
                        });

                        const apparition3 =
                            document.querySelector(".apparition3");
                        divScrollable.addEventListener("scroll", function (e) {
                            var scrollTop = divScrollable.scrollTop;
                            if (scrollTop > 1400 - deScrol) {
                                apparition3.classList.remove("invisible3");
                                apparition3.classList.add("visible3");
                            } else {
                                apparition3.classList.add("invisible3");
                                apparition3.classList.remove("visible3");
                            }
                        });

                        /***********************APPARITION PERSONNE 2*************************/
                        const apparition5 =
                            document.querySelector(".apparition5");
                        const apparitionAudio2 =
                            document.querySelector(".audio2");
                        divScrollable.addEventListener("scroll", function (e) {
                            var scrollTop = divScrollable.scrollTop;
                            if (scrollTop > 1300 - deScrol) {
                                apparition5.classList.remove("invisible5");
                                apparition5.classList.add("visible5");
                                apparitionAudio2.classList.remove("invisible6");
                                apparitionAudio2.classList.add("visible6");
                            } else {
                                apparition5.classList.add("invisible5");
                                apparition5.classList.remove("visible5");
                                apparitionAudio2.classList.add("invisible6");
                                apparitionAudio2.classList.remove("visible6");
                            }
                        });

                        const apparition7 =
                            document.querySelector(".apparition7");
                        divScrollable.addEventListener("scroll", function (e) {
                            var scrollTop = divScrollable.scrollTop;
                            if (scrollTop > 1500 - deScrol) {
                                apparition7.classList.remove("invisible7");
                                apparition7.classList.add("visible7");
                            } else {
                                apparition7.classList.add("invisible7");
                                apparition7.classList.remove("visible7");
                            }
                        });

                        /***********************FONCTION AUDIO*************************/
                        const playButton1 =
                            document.getElementById("playButton1");
                        const playButton2 =
                            document.getElementById("playButton2");
                        const soundImage1 = document.querySelector(".play1");
                        const soundImage2 = document.querySelector(".play2");

                        audioElement1 = new Audio("./music/audio/feo1.mp3");
                        audioElement2 = new Audio("./music/audio/feo2.mp3");

                        let isPlaying = false;

                        playButton1.addEventListener("click", function () {
                            if (!isPlaying) {
                                audioElement1.play();
                                isPlaying = true;
                                soundImage1.src = "img/pause.png";
                                audioElement2.pause();
                                sound.pause();
                                soundImage2.src = "img/play.png";
                            } else {
                                audioElement1.pause();
                                isPlaying = false;
                                soundImage1.src = "img/play.png";
                            }
                        });

                        playButton2.addEventListener("click", function () {
                            if (!isPlaying) {
                                audioElement2.play();
                                isPlaying = true;
                                soundImage2.src = "img/pause.png";
                                audioElement1.pause();
                                sound.pause();
                                soundImage1.src = "img/play.png";
                            } else {
                                audioElement2.pause();
                                isPlaying = false;
                                soundImage2.src = "img/play.png";
                            }
                        });
                    </script>

                    <!----------------------------CONTENU------------------------>

                    <div class="center">
                        <p id="description" class="apparition invisible"></p>
                    </div>

                    <script type="text/javascript">
                        const apparition =
                            document.querySelector(".apparition");
                        divScrollable = document.getElementById("myScroll");
                        divScrollable.addEventListener("scroll", function (e) {
                            var scrollTop = divScrollable.scrollTop;
                            if (scrollTop > 1800 - deScrol) {
                                apparition.classList.remove("invisible");
                                apparition.classList.add("visible");
                            } else {
                                apparition.classList.add("invisible");
                                apparition.classList.remove("visible");
                            }
                        });
                    </script>
                    <!----------------------------CAROUSEL------------------------>
                    <div class="carousel">
                        <button id="prev">&#10096;</button>
                        <button id="next">&#10097;</button>
                        <ul id="carousel-list">
                            <li class="slide">
                                <img
                                    class="image-cliquable"
                                    alt="image carousel"
                                />
                            </li>
                            <li class="slide active">
                                <img
                                    class="image-cliquable"
                                    alt="image carousel"
                                />
                            </li>
                            <li class="slide">
                                <img
                                    class="image-cliquable"
                                    alt="image carousel"
                                />
                            </li>
                        </ul>
                    </div>

                    <script type="text/javascript">
                        const buttons = document.querySelectorAll(".btn");
                        const slides = document.querySelectorAll(".slide");
                        buttons.forEach((button) => {
                            button.addEventListener("click", (e) => {
                                const calcNextSlide =
                                    e.target.id === "next" ? 1 : -1;
                                const slideActive =
                                    document.querySelector(".activ");

                                newIndex =
                                    calcNextSlide +
                                    [...slides].indexOf(slideActive);

                                if (newIndex < 0)
                                    newIndex = [...slides].length - 1;
                                if (newIndex >= [...slides].length)
                                    newIndex = 0;
                                slides[newIndex].classList.add("activ");

                                slideActive.classList.remove("activ");
                            });
                        });
                    </script>
                </div>
            </div>
        </div>
        <!-- FIN Contenue du Plus d'infos sur ce lieu -->

        <input type="hidden" id="testStart" value="true" />
        <input type="hidden" id="isDark" value="true" />
        <input type="hidden" id="ls360" value="" />

        <script type="importmap">
            {
                "imports": {
                    "three": "https://unpkg.com/three/build/three.module.js",
                    "three/": "https://unpkg.com/three/",
                    "troika-three-text": "https://unpkg.com/troika-three-text@latest/dist/troika-three-text.esm.js",
                    "troika-three-utils": "https://unpkg.com/troika-three-utils@latest/dist/troika-three-utils.esm.js",
                    "troika-worker-utils": "https://unpkg.com/troika-worker-utils@latest/dist/troika-worker-utils.esm.js",
                    "webgl-sdf-generator": "https://unpkg.com/webgl-sdf-generator@latest/dist/webgl-sdf-generator.mjs",
                    "bidi-js": "https://unpkg.com/bidi-js@latest/dist/bidi.mjs"
                }
            }
        </script>

        <script type="module" src="main.js"></script>

        <audio loop id="audioPlayer2" src="public/night.mp3"></audio>
        <script>
            dark = false;
            darkness = 2;
            document.addEventListener("DOMContentLoaded", function () {
                var isMuted = false;

                var audioPlayer2 = document.getElementById("audioPlayer2");
                var soundIcon = document.getElementById("soundIcon");
                var explorer_bt = document.getElementById("explorer_bt");
                var show_description =
                    document.getElementById("show_description");
                var quiter_description =
                    document.getElementById("quiter_description");

                function toggleMute() {
                    isMuted = !isMuted;

                    if (isMuted) {
                        audioPlayer2.pause();
                        soundIcon.src = "./img/mute.png";
                    } else {
                        audioPlayer2.play().catch((error) => {
                            console.error("Failed to play audio: ", error);
                        });
                        soundIcon.src = "./img/music.png";
                    }
                }

                function playSound() {
                    document.getElementById("testStart").value = false;
                    audioPlayer2.play();
                    audioPlayer2.volume = 1;
                }

                function changeCameraView() {
                    console.log("Change Camera View");
                }

                var mapIcon = document.querySelector(
                    ".navbar-icons img:nth-child(2)"
                );

                mapIcon.addEventListener("click", changeCameraView);

                window.onscroll = function () {
                    var navbar = document.getElementById("navbar");
                    if (
                        document.body.scrollTop > 20 ||
                        document.documentElement.scrollTop > 20
                    ) {
                        navbar.style.backgroundColor =
                            "rgba(255, 255, 255, 0.8)";
                    } else {
                        navbar.style.backgroundColor = "transparent";
                    }
                };

                function showDescription() {
                    var main = document.getElementById("desc-main");
                    main.className = "desc-main is_displayed";
                }

                function quitDescription() {
                    var main = document.getElementById("desc-main");
                    main.className = "desc-main";
                }

                soundIcon.addEventListener("click", toggleMute);
                explorer_bt.addEventListener("click", playSound);
                show_description.addEventListener("click", showDescription);
                quiter_description.addEventListener("click", quitDescription);
            });
        </script>
    </body>
</html>
